os: linux

language: go

go:
- '1.16'
- master

services:
- docker

env:
  global:
    - APP_LOG_FILE="castellers.log"

install: true

before_install:
- openssl aes-256-cbc -K $encrypted_7eca150e901f_key -iv $encrypted_7eca150e901f_iv -in travis-deploy.enc -out travis-deploy -d
- eval "$(ssh-agent -s)"
- chmod 600 travis-deploy
- ssh-add travis-deploy

script:
- go test -v ./...

before_deploy: bash build.sh

deploy:
  - provider: script
    edge: true
    script: bash deploy.sh dev
    on:
      go: '1.16'
      all_branches: true
      condition: $TRAVIS_BRANCH != master
  - provider: script
    edge: true
    script: bash deploy.sh latest
    on:
      go: '1.16'
      branch: master
