language: go

go:
  - "1.10"
  - master

sudo: required

services:
  - docker

env:
  - APP_LOG_FILE="castellers.log"

branches:
  only:
  - master
  - dev


before_script:
  - npm install frontend
script:
    - go test -v ./...
    - cd frontend && npm run test

before_deploy: bash build.sh dev

deploy:
  skip_cleanup: true
  provider: script
  script: bash docker_hub_push.sh dev
  on:
    branch: dev
    go: "1.10"
