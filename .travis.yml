os: linux

language: go

go:
- '1.14'
- master

services:
- docker

env:
  global:
    - APP_LOG_FILE="castellers.log"
    - GO111MODULE=on

install: true

before_install:
- openssl aes-256-cbc -K $encrypted_7eca150e901f_key -iv $encrypted_7eca150e901f_iv -in travis-deploy.enc -out travis-deploy -d
- eval "$(ssh-agent -s)"
- chmod 600 travis-deploy
- ssh-add travis-deploy

script:
- go test -v -mod=vendor ./...

before_deploy: bash build.sh latest

deploy:
  edge: true
  provider: script
  script: bash deploy.sh latest
  on:
    go: '1.12'
    branch: master
